syntax = "proto3";
import "google/protobuf/timestamp.proto";
package types;
option go_package = "github.com/okzmo/nyo/proto";

message WSMessage {
  oneof content {
    ChangeStatus user_change_status = 1;
    NewChatMessage new_chat_message = 2;
    EditChatMessage edit_chat_message = 3;
    DeleteChatMessage delete_chat_message = 4;
    StartChannel start_channel = 5;
    StartCategory start_category = 6;
    KillServer kill_server = 7;
    KillChannel kill_channel = 8;
    KillCategory kill_category = 9;
    CreateOrEditRole create_or_edit_role = 10;
    RemoveRole remove_role = 11;
    MoveRole move_role = 12;
    AddRoleMember add_role_member = 13;
    RemoveRoleMember remove_role_member = 14;
    FriendRequest friend_request = 15;
    AcceptFriendRequest accept_friend_request = 16;
    RemoveFriend remove_friend = 17;
    AccountDeletion account_deletion = 18;
    AvatarServerChange avatar_server_change = 19;
    ProfileServerChange profile_server_change = 20;
    EditChannel edit_channel = 21;
    EditCategory edit_category = 22;
    LeaveServer leave_server = 23;
    BanUser ban_user = 24;
    KickUser kick_user = 25;
  }
}

message BanUser {
  string server_id = 1;
  string user_id = 2;
  string reason = 3;
  google.protobuf.Timestamp duration = 4;
}

message KickUser {
  string server_id = 1;
  string user_id = 2;
  string reason = 3;
}

message EditChannel {
  Channel channel = 1;
}

message EditCategory {
  Category category = 1;
}

message AvatarServerChange {
  string server_id = 1;
  optional string avatar_url = 2;
  optional string banner_url = 3;
}

message ProfileServerChange {
  string server_id = 1;
  string name = 2;
  bytes description = 3;
  bool public = 4;
}

message FriendRequest {
  string friendship_id = 1;
  User sender = 2;
  bool accepted = 3;
}

message AcceptFriendRequest {
  string friendship_id = 1;
  User sender = 2;
  string channel_id = 3;
}

message RemoveFriend {
  string friendship_id = 1;
  User sender = 2;
  User receiver = 3;
}

message ChangeStatus {
  string type = 1;
	User user = 2;
	string channel_id = 3;
	string server_id = 4;
	string status = 5;
  repeated string roles = 6;
}

message NewChatMessage {
  Message message = 1;
}

message EditChatMessage {
  Message message = 1;
}

message DeleteChatMessage {
  Message message = 1;
}

message StartChannel {
	Channel channel = 1;
}

message KillServer {
  string server_id = 1;
}

message KillChannel {
	Channel channel = 1;
}

message StartCategory {
  Category category = 1;
}

message KillCategory {
  string server_id = 1;
  string category_id = 2;
  repeated string channels_ids = 3;
}

message CreateOrEditRole {
  Role role = 1;
}

message RemoveRole {
  Role role = 1;
}

message MoveRole {
  Role moved_role = 1;
  Role target_role = 2;
  int32 from = 3;
  int32 to = 4;
}

message AddRoleMember {
  string user_id = 1;
  Role role = 2;
}

message RemoveRoleMember {
  string user_id = 1;
  Role role = 2;
}

message Message {
	string id = 1;
	User author = 2;
	string server_id = 3;
	string channel_id = 4;
	bytes content = 5;
	bool everyone = 6;
	repeated string mentions_users= 7;
	repeated string mentions_channels = 8;
	bytes attachments = 9;
	google.protobuf.Timestamp created_at = 10;
	google.protobuf.Timestamp updated_at = 11;
}

message User {
  string id = 1;
  string username = 2;
  string display_name = 3;
  string avatar = 4;
  string banner = 5;
  bytes about_me = 6;
  int32 experience = 7;
  string main_color = 8;
  repeated UserLinksRow links = 9;
  repeated UserFactsRow facts = 10;
	google.protobuf.Timestamp created_at = 11;
	google.protobuf.Timestamp updated_at = 12;
}

message Category {
	string id = 1;
	int32 position = 2;
	string server_id = 3;
	string name = 4;
	repeated string  users = 5;
	repeated string  roles = 6;
	bool e2ee = 7;
	google.protobuf.Timestamp created_at = 8;
	google.protobuf.Timestamp updated_at = 9;
}

message Role {
  string id = 1;
  string server_id = 2;
	int32 position = 3;
  string name = 4;
  string color = 5;
  repeated string abilities = 6;
	google.protobuf.Timestamp created_at = 7;
	google.protobuf.Timestamp updated_at = 8;
}

message Channel {
	string id = 1;
	string server_id = 2;
  string category_id = 3;
	string name = 4;
	string description = 5;
	string type = 6;
	bool e2ee = 7;
	repeated string users = 8;
	repeated string roles = 9;
  int32 position = 10;
	google.protobuf.Timestamp created_at = 11;
	google.protobuf.Timestamp updated_at = 12;
}

message UserLinksRow {
  string id = 1;
  string label = 2;
  string url = 3;
}

message UserFactsRow {
  string id = 1;
  string label = 2;
  string value = 3;
}

message GetServerUsers {
  repeated string user_ids = 1;
}

message GetFriends {
  repeated string friend_ids = 1;
}

message AccountDeletion {
  string user_id = 1;
  string server_id = 2;
}

message LeaveServer {
  string server_id = 1;
  string user_id = 2;
}
